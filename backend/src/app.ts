import express from 'express'
import cors from 'cors'
import swagger from 'swagger-ui-express'
import router from './routes'
import db from './config/db'
import * as docs from './swagger.json'

const app = express()

export const connect = async () => {
  try {
    await db.authenticate()
    db.sync()
    console.log('[db] Sucessfully connected to PostgreSQL')
  } catch (error) {
    console.log('[db] There was an error trying to connect to PostgreSQL')
  }
}

connect()
app.use(express.json())
app.use(cors())
router(app)

app.use(
  '/api/docs',
  swagger.serve,
  swagger.setup(docs, {
    customSiteTitle: 'Products Admin API Docs',
    customCss: `.topbar-wrapper .link {
  content: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxLjEzZW0iIGhlaWdodD0iMWVtIiB2aWV3Qm94PSIwIDAgMjU2IDIyOCI+PHBhdGggZmlsbD0iIzAwZDhmZiIgZD0iTTIxMC40ODMgNzMuODI0YTE3MiAxNzIgMCAwIDAtOC4yNC0yLjU5N2MuNDY1LTEuOS44OTMtMy43NzcgMS4yNzMtNS42MjFjNi4yMzgtMzAuMjgxIDIuMTYtNTQuNjc2LTExLjc2OS02Mi43MDhjLTEzLjM1NS03LjctMzUuMTk2LjMyOS01Ny4yNTQgMTkuNTI2YTE3MSAxNzEgMCAwIDAtNi4zNzUgNS44NDhhMTU2IDE1NiAwIDAgMC00LjI0MS0zLjkxN0MxMDAuNzU5IDMuODI5IDc3LjU4Ny00LjgyMiA2My42NzMgMy4yMzNDNTAuMzMgMTAuOTU3IDQ2LjM3OSAzMy44OSA1MS45OTUgNjIuNTg4YTE3MSAxNzEgMCAwIDAgMS44OTIgOC40OGMtMy4yOC45MzItNi40NDUgMS45MjQtOS40NzQgMi45OEMxNy4zMDkgODMuNDk4IDAgOTguMzA3IDAgMTEzLjY2OGMwIDE1Ljg2NSAxOC41ODIgMzEuNzc4IDQ2LjgxMiA0MS40MjdhMTQ2IDE0NiAwIDAgMCA2LjkyMSAyLjE2NWExNjggMTY4IDAgMCAwLTIuMDEgOS4xMzhjLTUuMzU0IDI4LjItMS4xNzMgNTAuNTkxIDEyLjEzNCA1OC4yNjZjMTMuNzQ0IDcuOTI2IDM2LjgxMi0uMjIgNTkuMjczLTE5Ljg1NWExNDYgMTQ2IDAgMCAwIDUuMzQyLTQuOTIzYTE2OCAxNjggMCAwIDAgNi45MiA2LjMxNGMyMS43NTggMTguNzIyIDQzLjI0NiAyNi4yODIgNTYuNTQgMTguNTg2YzEzLjczMS03Ljk0OSAxOC4xOTQtMzIuMDAzIDEyLjQtNjEuMjY4YTE0NSAxNDUgMCAwIDAtMS41MzUtNi44NDJjMS42Mi0uNDggMy4yMS0uOTc0IDQuNzYtMS40ODhjMjkuMzQ4LTkuNzIzIDQ4LjQ0My0yNS40NDMgNDguNDQzLTQxLjUyYzAtMTUuNDE3LTE3Ljg2OC0zMC4zMjYtNDUuNTE3LTM5Ljg0NG0tNi4zNjUgNzAuOTg0cS0yLjEwMi42OTQtNC4zIDEuMzQ1Yy0zLjI0LTEwLjI1Ny03LjYxMi0yMS4xNjMtMTIuOTYzLTMyLjQzMmM1LjEwNi0xMSA5LjMxLTIxLjc2NyAxMi40NTktMzEuOTU3YzIuNjE5Ljc1OCA1LjE2IDEuNTU3IDcuNjEgMi40YzIzLjY5IDguMTU2IDM4LjE0IDIwLjIxMyAzOC4xNCAyOS41MDRjMCA5Ljg5Ni0xNS42MDYgMjIuNzQzLTQwLjk0NiAzMS4xNG0tMTAuNTE0IDIwLjgzNGMyLjU2MiAxMi45NCAyLjkyNyAyNC42NCAxLjIzIDMzLjc4N2MtMS41MjQgOC4yMTktNC41OSAxMy42OTgtOC4zODIgMTUuODkzYy04LjA2NyA0LjY3LTI1LjMyLTEuNC00My45MjctMTcuNDEyYTE1NyAxNTcgMCAwIDEtNi40MzctNS44N2M3LjIxNC03Ljg4OSAxNC40MjMtMTcuMDYgMjEuNDU5LTI3LjI0NmMxMi4zNzYtMS4wOTggMjQuMDY4LTIuODk0IDM0LjY3MS01LjM0NXEuNzg1IDMuMTYyIDEuMzg2IDYuMTkzTTg3LjI3NiAyMTQuNTE1Yy03Ljg4MiAyLjc4My0xNC4xNiAyLjg2My0xNy45NTUuNjc1Yy04LjA3NS00LjY1Ny0xMS40MzItMjIuNjM2LTYuODUzLTQ2Ljc1MmExNTcgMTU3IDAgMCAxIDEuODY5LTguNDk5YzEwLjQ4NiAyLjMyIDIyLjA5MyAzLjk4OCAzNC40OTggNC45OTRjNy4wODQgOS45NjcgMTQuNTAxIDE5LjEyOCAyMS45NzYgMjcuMTVhMTM1IDEzNSAwIDAgMS00Ljg3NyA0LjQ5MmMtOS45MzMgOC42ODItMTkuODg2IDE0Ljg0Mi0yOC42NTggMTcuOTRNNTAuMzUgMTQ0Ljc0N2MtMTIuNDgzLTQuMjY3LTIyLjc5Mi05LjgxMi0yOS44NTgtMTUuODYzYy02LjM1LTUuNDM3LTkuNTU1LTEwLjgzNi05LjU1NS0xNS4yMTZjMC05LjMyMiAxMy44OTctMjEuMjEyIDM3LjA3Ni0yOS4yOTNjMi44MTMtLjk4IDUuNzU3LTEuOTA1IDguODEyLTIuNzczYzMuMjA0IDEwLjQyIDcuNDA2IDIxLjMxNSAxMi40NzcgMzIuMzMyYy01LjEzNyAxMS4xOC05LjM5OSAyMi4yNDktMTIuNjM0IDMyLjc5MmExMzUgMTM1IDAgMCAxLTYuMzE4LTEuOTc5bTEyLjM3OC04NC4yNmMtNC44MTEtMjQuNTg3LTEuNjE2LTQzLjEzNCA2LjQyNS00Ny43ODljOC41NjQtNC45NTggMjcuNTAyIDIuMTExIDQ3LjQ2MyAxOS44MzVhMTQ0IDE0NCAwIDAgMSAzLjg0MSAzLjU0NWMtNy40MzggNy45ODctMTQuNzg3IDE3LjA4LTIxLjgwOCAyNi45ODhjLTEyLjA0IDEuMTE2LTIzLjU2NSAyLjkwOC0zNC4xNjEgNS4zMDlhMTYwIDE2MCAwIDAgMS0xLjc2LTcuODg3bTExMC40MjcgMjcuMjY4YTM0OCAzNDggMCAwIDAtNy43ODUtMTIuODAzYzguMTY4IDEuMDMzIDE1Ljk5NCAyLjQwNCAyMy4zNDMgNC4wOGMtMi4yMDYgNy4wNzItNC45NTYgMTQuNDY1LTguMTkzIDIyLjA0NWEzODEgMzgxIDAgMCAwLTcuMzY1LTEzLjMyMm0tNDUuMDMyLTQzLjg2MWM1LjA0NCA1LjQ2NSAxMC4wOTYgMTEuNTY2IDE1LjA2NSAxOC4xODZhMzIyIDMyMiAwIDAgMC0zMC4yNTctLjAwNmM0Ljk3NC02LjU1OSAxMC4wNjktMTIuNjUyIDE1LjE5Mi0xOC4xOE04Mi44MDIgODcuODNhMzIzIDMyMyAwIDAgMC03LjIyNyAxMy4yMzhjLTMuMTg0LTcuNTUzLTUuOTA5LTE0Ljk4LTguMTM0LTIyLjE1MmM3LjMwNC0xLjYzNCAxNS4wOTMtMi45NyAyMy4yMDktMy45ODRhMzIyIDMyMiAwIDAgMC03Ljg0OCAxMi44OTdtOC4wODEgNjUuMzUyYy04LjM4NS0uOTM2LTE2LjI5MS0yLjIwMy0yMy41OTMtMy43OTNjMi4yNi03LjMgNS4wNDUtMTQuODg1IDguMjk4LTIyLjZhMzIxIDMyMSAwIDAgMCA3LjI1NyAxMy4yNDZjMi41OTQgNC40OCA1LjI4IDguODY4IDguMDM4IDEzLjE0N20zNy41NDIgMzEuMDNjLTUuMTg0LTUuNTkyLTEwLjM1NC0xMS43NzktMTUuNDAzLTE4LjQzM2M0LjkwMi4xOTIgOS44OTkuMjkgMTQuOTc4LjI5YzUuMjE4IDAgMTAuMzc2LS4xMTcgMTUuNDUzLS4zNDNjLTQuOTg1IDYuNzc0LTEwLjAxOCAxMi45Ny0xNS4wMjggMTguNDg2bTUyLjE5OC01Ny44MTdjMy40MjIgNy44IDYuMzA2IDE1LjM0NSA4LjU5NiAyMi41MmMtNy40MjIgMS42OTQtMTUuNDM2IDMuMDU4LTIzLjg4IDQuMDcxYTM4MiAzODIgMCAwIDAgNy44NTktMTMuMDI2YTM0NyAzNDcgMCAwIDAgNy40MjUtMTMuNTY1bS0xNi44OTggOC4xMDFhMzU5IDM1OSAwIDAgMS0xMi4yODEgMTkuODE1YTMyOSAzMjkgMCAwIDEtMjMuNDQ0LjgyM2MtNy45NjcgMC0xNS43MTYtLjI0OC0yMy4xNzgtLjczMmEzMTAgMzEwIDAgMCAxLTEyLjUxMy0xOS44NDZoLjAwMWEzMDcgMzA3IDAgMCAxLTEwLjkyMy0yMC42MjdhMzEwIDMxMCAwIDAgMSAxMC44OS0yMC42MzdsLS4wMDEuMDAxYTMwNyAzMDcgMCAwIDEgMTIuNDEzLTE5Ljc2MWM3LjYxMy0uNTc2IDE1LjQyLS44NzYgMjMuMzEtLjg3NkgxMjhjNy45MjYgMCAxNS43NDMuMzAzIDIzLjM1NC44ODNhMzI5IDMyOSAwIDAgMSAxMi4zMzUgMTkuNjk1YTM1OSAzNTkgMCAwIDEgMTEuMDM2IDIwLjU0YTMzMCAzMzAgMCAwIDEtMTEgMjAuNzIybTIyLjU2LTEyMi4xMjRjOC41NzIgNC45NDQgMTEuOTA2IDI0Ljg4MSA2LjUyIDUxLjAyNnEtLjUxOCAyLjUwNC0xLjE1IDUuMDljLTEwLjYyMi0yLjQ1Mi0yMi4xNTUtNC4yNzUtMzQuMjMtNS40MDhjLTcuMDM0LTEwLjAxNy0xNC4zMjMtMTkuMTI0LTIxLjY0LTI3LjAwOGExNjEgMTYxIDAgMCAxIDUuODg4LTUuNGMxOC45LTE2LjQ0NyAzNi41NjQtMjIuOTQxIDQ0LjYxMi0xOC4zTTEyOCA5MC44MDhjMTIuNjI1IDAgMjIuODYgMTAuMjM1IDIyLjg2IDIyLjg2cy0xMC4yMzUgMjIuODYtMjIuODYgMjIuODZzLTIyLjg2LTEwLjIzNS0yMi44Ni0yMi44NnMxMC4yMzUtMjIuODYgMjIuODYtMjIuODYiLz48L3N2Zz4=');height:40px;width:auto'}`
  })
)

export default app
